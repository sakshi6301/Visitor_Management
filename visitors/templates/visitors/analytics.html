{% extends 'visitors/base.html' %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}

<h3>Analytics & Reports</h3>
<p class="text-muted">Visitor insights and trends</p>

<!-- Summary Cards -->
<div class="row g-3 mt-3">
    <div class="col-md-4">
        <div class="stat-card blue">
            <small>Today's Visitors</small>
            <h2>{{ total_today }}</h2>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card green">
            <small>This Week</small>
            <h2>{{ total_week }}</h2>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card yellow">
            <small>This Month</small>
            <h2>{{ total_month }}</h2>
        </div>
    </div>
</div>

<!-- Report Buttons -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Generate Reports</h5>
            </div>
            <div class="card-body">
                <a href="{% url 'generate_report' %}?type=daily" class="btn btn-primary me-2">Daily Report</a>
                <a href="{% url 'generate_report' %}?type=weekly" class="btn btn-success me-2">Weekly Report</a>
                <a href="{% url 'generate_report' %}?type=monthly" class="btn btn-warning me-2">Monthly Report</a>
                <a href="{% url 'generate_report' %}?type=all" class="btn btn-info">All Time</a>
            </div>
        </div>
    </div>
</div>

<!-- Department-wise Analysis -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Department-wise Visitors</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Department</th>
                            <th>Total</th>
                            <th>IN</th>
                            <th>OUT</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dept in dept_stats %}
                        <tr>
                            <td>{{ dept.hostel_or_office }}</td>
                            <td><span class="badge bg-secondary">{{ dept.total }}</span></td>
                            <td><span class="badge bg-success">{{ dept.in_count }}</span></td>
                            <td><span class="badge bg-danger">{{ dept.out_count }}</span></td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">No data</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Peak Hours -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Peak Visiting Hours (Last 7 Days)</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Visitors</th>
                            <th>Graph</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for peak in peak_hours %}
                        <tr>
                            <td>{{ peak.hour|date:"d M, h A" }}</td>
                            <td><span class="badge bg-primary">{{ peak.count }}</span></td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar" style="width: {{ peak.count }}0%">{{ peak.count }}</div>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">No data</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Daily Trend -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Daily Trend (Last 7 Days)</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Visitors</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for day in daily_trend %}
                        <tr>
                            <td>{{ day.date|date:"d M Y" }}</td>
                            <td><span class="badge bg-primary">{{ day.count }}</span></td>
                            <td>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar bg-info" style="width: {{ day.count }}0%">{{ day.count }}</div>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">No data</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}
